#!/usr/bin/env python3
"""
RGB to Papirus Color Mapper
Maps RGB or hex color to the closest available Papirus folder color.
"""

import sys
import math

# Papirus color definitions (approximate RGB values)
PAPIRUS_COLORS = {
    'adwaita': (153, 193, 241),
    'black': (0, 0, 0),
    'blue': (66, 133, 244),
    'bluegrey': (96, 125, 139),
    'breeze': (61, 174, 233),
    'brown': (121, 85, 72),
    'carmine': (169, 68, 66),
    'cyan': (0, 188, 212),
    'darkcyan': (0, 151, 167),
    'deeporange': (255, 87, 34),
    'green': (76, 175, 80),
    'grey': (158, 158, 158),
    'indigo': (63, 81, 181),
    'magenta': (233, 30, 99),
    'nordic': (136, 192, 208),
    'orange': (255, 152, 0),
    'palebrown': (141, 110, 99),
    'paleorange': (255, 171, 145),
    'pink': (244, 143, 177),
    'red': (244, 67, 54),
    'teal': (0, 150, 136),
    'violet': (156, 39, 176),
    'white': (255, 255, 255),
    'yaru': (233, 84, 32),
    'yellow': (255, 235, 59),
}

def hex_to_rgb(hex_color):
    """Convert hex color to RGB tuple."""
    hex_color = hex_color.lstrip('#')
    if len(hex_color) != 6:
        raise ValueError(f"Invalid hex color: #{hex_color}")
    return tuple(int(hex_color[i:i+2], 16) for i in (0, 2, 4))

def color_distance(rgb1, rgb2):
    """Calculate Euclidean distance between two RGB colors."""
    return math.sqrt(sum((a - b) ** 2 for a, b in zip(rgb1, rgb2)))

def find_closest_color(rgb):
    """Find the closest Papirus color to the given RGB color."""
    closest_color = None
    min_distance = float('inf')
    
    for color_name, color_rgb in PAPIRUS_COLORS.items():
        distance = color_distance(rgb, color_rgb)
        if distance < min_distance:
            min_distance = distance
            closest_color = color_name
    
    return closest_color

def main():
    # Check for verbose flag
    verbose = '--verbose' in sys.argv or '-v' in sys.argv
    args = [arg for arg in sys.argv[1:] if arg not in ('--verbose', '-v')]
    
    if len(args) < 1:
        print("Usage: rgb_to_papirus.py <r> <g> <b> [-v|--verbose]")
        print("   OR: rgb_to_papirus.py <hex_color> [-v|--verbose]")
        print("\nExamples:")
        print("  rgb_to_papirus.py 255 87 34")
        print("  rgb_to_papirus.py '#FF5733'")
        print("  rgb_to_papirus.py FF5733 -v")
        sys.exit(1)
    
    try:
        # Try parsing as hex first
        if len(args) == 1:
            input_color = args[0]
            if input_color.startswith('#') or len(input_color) == 6:
                rgb = hex_to_rgb(input_color)
            else:
                # Single argument that's not hex - error
                print("Error: Single argument must be a hex color", file=sys.stderr)
                sys.exit(1)
        # Parse as RGB
        elif len(args) == 3:
            rgb = tuple(int(x) for x in args)
            if not all(0 <= x <= 255 for x in rgb):
                raise ValueError("RGB values must be between 0 and 255")
        else:
            print("Error: Invalid number of arguments", file=sys.stderr)
            sys.exit(1)
        
        closest_color = find_closest_color(rgb)
        
        # Output just the color name (useful for scripting)
        print(closest_color)
        
        # Optional: show RGB values if verbose
        if verbose:
            papirus_rgb = PAPIRUS_COLORS[closest_color]
            print(f"\nInput color:  RGB{rgb}", file=sys.stderr)
            print(f"Closest match: {closest_color} â†’ RGB{papirus_rgb}", file=sys.stderr)
    
    except ValueError as e:
        print(f"Error: {e}", file=sys.stderr)
        sys.exit(1)

if __name__ == '__main__':
    main()
